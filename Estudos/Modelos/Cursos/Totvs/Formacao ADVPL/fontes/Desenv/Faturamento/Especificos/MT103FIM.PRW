#INCLUDE "PROTHEUS.CH"
#INCLUDE "TBICONN.CH"
#DEFINE cEnt Chr(13)+Chr(10)

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบOriginal  ณ MT103FIM บAutor  บ Joni Fujiyama      บ Data บ 02/12/2014  บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออสออออออออออออออออออออสออออออสอออออออออออออนฑฑ
ฑฑบDesc.     ณ Ponto de entrada que serแ executado ap๓s a digita็ใo do do บฑฑ
ฑฑบ          ณ cumento de entrada de nota de devolu็ใo, emitida pelo clienบฑฑ
ฑฑบ          ณ te (devolvendo a consigna็ใo).                             บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ                                                            บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/

User Function MT103FIM()

Local _nOpcao    := PARAMIXB[1] 		// Op็ใo Escolhida pelo usuario no aRotina
Local _nConfirma := PARAMIXB[2]
Local _aArea 	 := GetArea()
Local lAmbSch := upper(alltrim(GetEnvServer())) $ "SCHEDULE" //ambiente Schedule

//Acerto de consigna็ใo com cliente
//If _nOpcao == 3 .and. _nConfirma == 1
If _nConfirma == 1
	
	If _nOpcao == 3 .and. !lAmbSch .and. Alltrim(FunName()) <> "GENA021"
		U_GENA013()
	Endif
	
	If SF1->(FieldPos("F1_XIDNFE")) > 0 .and. Empty(SF1->F1_XIDNFE)
		Reclock("SF1",.F.)
		cIdNf := GetMV("GEN_COM008")
		SF1->F1_XIDNFE := cIdNf
		MsUnlock()
		PutMV("GEN_COM008",soma1(cIdNf))
	Endif
Endif

RestArea(_aArea)

Return()



/*/

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณMT103FIM  บAutor  ณDanilo Azevedo      บ Data ณ  14/09/15   บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณPonto de entrada na gravacao da Pre nota (MATA140)          บฑฑ
ฑฑบ          ณ                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ GEN                                                        บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/

User Function SD1140I()

If SF1->(FieldPos("F1_XIDNFE")) > 0 .and. Empty(SF1->F1_XIDNFE)
	Reclock("SF1",.F.)
	cIdNf := GetMV("GEN_COM008")
	SF1->F1_XIDNFE := cIdNf
	MsUnlock()
	PutMV("GEN_COM008",soma1(cIdNf))
Endif

Return()
